name: System Maintenance
description: Comprehensive system updates and maintenance with AI-agent style summaries
author: System Admin
version: 2.0
tags:
  - maintenance
  - updates
  - system
  - cleanup
  - macos
  - homebrew
  - npm
  - ruby

commands:
  - name: "๐ System Status Check"
    command: |
      # Initialize summary tracking
      SUMMARY_ITEMS=()
      WARNINGS=()
      ERRORS=()
      
      echo "=== ๐ฅ๏ธ  SYSTEM INFO ==="
      MACOS_VERSION=$(sw_vers -productVersion)
      sw_vers
      SUMMARY_ITEMS+=("macOS $MACOS_VERSION system info collected")
      
      echo -e "\n=== ๐พ DISK SPACE ==="
      diskutil info / | grep -E "(Free Space|Available Space|APFS Free Space)"
      SUMMARY_ITEMS+=("Disk space verified - system healthy")
      
      echo -e "\n=== ๐ LARGE FOLDERS ==="
      DOWNLOADS_SIZE=$(du -sh ~/Downloads 2>/dev/null | cut -f1)
      DESKTOP_SIZE=$(du -sh ~/Desktop 2>/dev/null | cut -f1)
      CACHE_SIZE=$(du -sh ~/Library/Caches 2>/dev/null | cut -f1)
      echo "Downloads: $DOWNLOADS_SIZE"
      echo "Desktop: $DESKTOP_SIZE"
      echo "Caches: $CACHE_SIZE"
      SUMMARY_ITEMS+=("Folder sizes analyzed (Downloads: $DOWNLOADS_SIZE, Desktop: $DESKTOP_SIZE, Caches: $CACHE_SIZE)")
      
      echo -e "\n=== ๐ NETWORK ==="
      if ping -c 1 google.com > /dev/null 2>&1; then
        echo "โ Internet: Connected"
        SUMMARY_ITEMS+=("Network connectivity verified")
      else
        echo "โ Internet: Disconnected"
        ERRORS+=("Network connectivity failed")
      fi
      
      # Summary
      echo -e "\n\033[0;35mโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ\033[0m"
      echo -e "\033[0;35mโ                           ๐ MAINTENANCE SUMMARY                               โ\033[0m"
      echo -e "\033[0;35mโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ\033[0m"
      
      echo -e "\n\033[0;36m๐ Completed:\033[0m $(date)"
      echo -e "\033[0;36mโก Command:\033[0m System Status Check"
      
      if [[ ${#SUMMARY_ITEMS[@]} -gt 0 ]]; then
        echo -e "\n\033[0;32mโ Status Checks:\033[0m"
        for item in "${SUMMARY_ITEMS[@]}"; do
          echo -e "   โข $item"
        done
      fi
      
      if [[ ${#ERRORS[@]} -gt 0 ]]; then
        echo -e "\n\033[0;31mโ Issues Found:\033[0m"
        for error in "${ERRORS[@]}"; do
          echo -e "   โข $error"
        done
      fi
      
      FREE_SPACE=$(diskutil info / | grep -E "Free Space" | awk '{print $4 " " $5}' | sed 's/[(),]//g')
      echo -e "\n\033[0;36m๐พ System Status:\033[0m"
      echo -e "   โข Free disk space: $FREE_SPACE"
      echo -e "   โข macOS: $MACOS_VERSION"
      echo -e "   โข Downloads folder: $DOWNLOADS_SIZE"
      echo -e "   โข Desktop folder: $DESKTOP_SIZE"
      echo -e "   โข Cache folder: $CACHE_SIZE"
      
      echo -e "\n\033[0;35m๐ฏ Recommendations:\033[0m"
      echo -e "   โข Run 'Check Package Updates' to see what needs updating"
      echo -e "   โข Run 'Update All Packages' to apply updates"
      echo -e "   โข Consider 'System Cleanup' for maintenance"
      
      echo -e "\n\033[0;35mโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ\033[0m"

  - name: "๐ฆ Check Package Updates"
    command: |
      echo "=== ๐บ HOMEBREW ==="
      brew update > /dev/null 2>&1
      OUTDATED_BREW=$(brew outdated)
      if [ -n "$OUTDATED_BREW" ]; then
        echo "๐ Outdated packages:"
        echo "$OUTDATED_BREW"
      else
        echo "โ All Homebrew packages up to date"
      fi
      
      echo -e "\n=== ๐ฆ NPM GLOBAL ==="
      OUTDATED_NPM=$(npm outdated -g 2>/dev/null)
      if [ -n "$OUTDATED_NPM" ]; then
        echo "๐ Outdated npm packages:"
        echo "$OUTDATED_NPM"
      else
        echo "โ All npm packages up to date"
      fi
      
      echo -e "\n=== ๐ด RUBY GEMS ==="
      OUTDATED_GEMS=$(gem outdated 2>/dev/null | wc -l)
      if [ "$OUTDATED_GEMS" -gt 0 ]; then
        echo "๐ $OUTDATED_GEMS gems need updating"
        echo "Run: gem update"
      else
        echo "โ All gems up to date"
      fi
      
      echo -e "\n=== ๐ PYTHON ==="
      python3 --version
      echo "Note: Use 'pipx' for Python applications or virtual environments for development"

  - name: "๐ Update All Packages"
    command: |
      echo "=== ๐บ UPDATING HOMEBREW ==="
      brew update && brew upgrade
      
      echo -e "\n=== ๐ฆ UPDATING NPM ==="
      npm update -g
      
      echo -e "\n=== ๐ด UPDATING RUBY GEMS ==="
      gem update --system 2>/dev/null || echo "โ๏ธ  RubyGems system update failed (may need newer Ruby)"
      gem update
      
      echo -e "\n=== โ UPDATES COMPLETE ==="

  - name: "๐งน System Cleanup"
    command: |
      echo "=== ๐บ HOMEBREW CLEANUP ==="
      brew cleanup
      brew autoremove
      
      echo -e "\n=== ๐ฆ NPM CACHE CLEANUP ==="
      npm cache verify
      
      echo -e "\n=== ๐ด RUBY CLEANUP ==="
      gem cleanup
      
      echo -e "\n=== ๐๏ธ  TRASH CLEANUP ==="
      if command -v trash &> /dev/null; then
        trash -e
        echo "โ Trash emptied"
      else
        echo "โ๏ธ  'trash' command not found. Install with: brew install trash"
      fi
      
      echo -e "\n=== โ CLEANUP COMPLETE ==="

  - name: "๐ง Environment Variables Check"
    command: |
      echo "=== ๐ง ENVIRONMENT VARIABLES ==="
      echo "SHELL: $SHELL"
      echo "PATH length: $(echo $PATH | wc -c) characters"
      echo -e "\n=== ๐ฑ ANDROID SDK ==="
      echo "ANDROID_HOME: ${ANDROID_HOME:-'โ Not set'}"
      echo "ANDROID_SDK_ROOT: ${ANDROID_SDK_ROOT:-'โ Not set'}"
      echo -e "\n=== โ JAVA ==="
      if command -v java &> /dev/null; then
        echo "Java: $(java -version 2>&1 | head -1)"
        echo "JAVA_HOME: ${JAVA_HOME:-'โ Not set'}"
      else
        echo "โ Java not found"
      fi
      echo -e "\n=== ๐ PYTHON ==="
      echo "Python: $(python3 --version)"
      echo "Python path: $(which python3)"
      echo -e "\n=== ๐ด RUBY ==="
      echo "Ruby: $(ruby -v)"
      echo "Ruby path: $(which ruby)"
      echo "Rbenv versions:"
      rbenv versions 2>/dev/null || echo "โ rbenv not found"
      echo -e "\n=== ๐ NODE ==="
      if command -v node &> /dev/null; then
        echo "Node: $(node --version)"
        echo "npm: $(npm --version)"
      else
        echo "โ Node.js not found"
      fi
      echo -e "\n=== ๐ง .NET ==="
      echo "DOTNET_ROOT: ${DOTNET_ROOT:-'โ Not set'}"
      if command -v dotnet &> /dev/null; then
        echo "dotnet: $(dotnet --version 2>/dev/null || echo 'โ Not working')"
      fi

  - name: "๐ฉบ System Health Check"
    command: |
      echo "=== ๐ฉบ SYSTEM HEALTH ==="
      echo -e "\n๐บ Homebrew Doctor:"
      brew doctor 2>&1 | head -10
      
      echo -e "\n๐ Running Services:"
      launchctl list | grep -v com.apple | head -5
      
      echo -e "\n๐ Keychain Status:"
      security list-keychains | wc -l | xargs echo "Keychains configured:"
      
      echo -e "\n๐ก๏ธ  System Load:"
      uptime
      
      echo -e "\n๐พ Memory Usage:"
      vm_stat | head -5
      
      echo -e "\n๐ Battery (if applicable):"
      pmset -g batt 2>/dev/null | head -2 || echo "Desktop system or battery info unavailable"

  - name: "๐ฏ Quick Fix Common Issues"
    command: |
      echo "=== ๐ฏ APPLYING QUICK FIXES ==="
      
      echo "๐ Rebuilding launch services database..."
      /System/Library/Frameworks/CoreServices.framework/Frameworks/LaunchServices.framework/Support/lsregister -kill -r -domain local -domain system -domain user > /dev/null 2>&1
      
      echo "๐๏ธ  Rebuilding Spotlight index (if needed)..."
      # Only suggest, don't run automatically
      echo "  To rebuild: sudo mdutil -E /"
      
      echo "๐ง Clearing DNS cache..."
      sudo dscacheutil -flushcache > /dev/null 2>&1 || echo "  โ๏ธ  DNS cache flush requires password"
      
      echo "๐ฆ Rehashing shell commands..."
      hash -r
      
      if command -v rbenv &> /dev/null; then
        echo "๐ด Rehashing rbenv..."
        rbenv rehash
      fi
      
      echo "โ Quick fixes applied!"

  - name: "๐ Generate System Report"
    command: |
      REPORT_FILE="$HOME/system_report_$(date +%Y%m%d_%H%M%S).txt"
      
      echo "=== ๐ SYSTEM MAINTENANCE REPORT ===" > "$REPORT_FILE"
      echo "Generated: $(date)" >> "$REPORT_FILE"
      echo "" >> "$REPORT_FILE"
      
      echo "๐ฅ๏ธ  SYSTEM INFO:" >> "$REPORT_FILE"
      sw_vers >> "$REPORT_FILE"
      echo "" >> "$REPORT_FILE"
      
      echo "๐พ DISK SPACE:" >> "$REPORT_FILE"
      df -h / >> "$REPORT_FILE"
      echo "" >> "$REPORT_FILE"
      
      echo "๐ฆ INSTALLED VERSIONS:" >> "$REPORT_FILE"
      echo "Homebrew: $(brew --version | head -1)" >> "$REPORT_FILE"
      echo "Node.js: $(node --version 2>/dev/null || echo 'Not installed')" >> "$REPORT_FILE"
      echo "npm: $(npm --version 2>/dev/null || echo 'Not installed')" >> "$REPORT_FILE"
      echo "Python: $(python3 --version 2>/dev/null || echo 'Not installed')" >> "$REPORT_FILE"
      echo "Ruby: $(ruby -v 2>/dev/null || echo 'Not installed')" >> "$REPORT_FILE"
      echo "Java: $(java -version 2>&1 | head -1 2>/dev/null || echo 'Not installed')" >> "$REPORT_FILE"
      echo "" >> "$REPORT_FILE"
      
      echo "๐บ HOMEBREW PACKAGES:" >> "$REPORT_FILE"
      brew list --formula >> "$REPORT_FILE"
      echo "" >> "$REPORT_FILE"
      
      echo "๐ OUTDATED PACKAGES:" >> "$REPORT_FILE"
      brew outdated >> "$REPORT_FILE" 2>&1
      
      echo "โ Report saved to: $REPORT_FILE"
      echo "๐ View with: cat $REPORT_FILE"

  - name: "๐ Complete System Maintenance"
    command: |
      # Initialize comprehensive tracking
      SUMMARY_ITEMS=()
      WARNINGS=()
      ERRORS=()
      ACTIONS_TAKEN=()
      
      echo "\033[0;34m=== ๐ฅ๏ธ  SYSTEM INFO ===\033[0m"
      MACOS_VERSION=$(sw_vers -productVersion)
      sw_vers
      SUMMARY_ITEMS+=("macOS $MACOS_VERSION system info collected")
      
      echo -e "\n\033[0;34m=== ๐พ DISK SPACE ===\033[0m"
      diskutil info / | grep -E "(Free Space|Available Space|APFS Free Space)"
      SUMMARY_ITEMS+=("Disk space verified - system healthy")
      
      echo -e "\n\033[0;34m=== ๐ LARGE FOLDERS ===\033[0m"
      DOWNLOADS_SIZE=$(du -sh ~/Downloads 2>/dev/null | cut -f1)
      DESKTOP_SIZE=$(du -sh ~/Desktop 2>/dev/null | cut -f1)
      CACHE_SIZE=$(du -sh ~/Library/Caches 2>/dev/null | cut -f1)
      echo "Downloads: $DOWNLOADS_SIZE"
      echo "Desktop: $DESKTOP_SIZE"
      echo "Caches: $CACHE_SIZE"
      SUMMARY_ITEMS+=("Folder sizes analyzed (Downloads: $DOWNLOADS_SIZE, Desktop: $DESKTOP_SIZE, Caches: $CACHE_SIZE)")
      
      echo -e "\n\033[0;34m=== ๐ NETWORK ===\033[0m"
      if ping -c 1 google.com > /dev/null 2>&1; then
        echo "โ Internet: Connected"
        SUMMARY_ITEMS+=("Network connectivity verified")
      else
        echo "โ Internet: Disconnected"
        ERRORS+=("Network connectivity failed")
      fi
      
      echo -e "\n\033[0;34m=== ๐บ CHECKING HOMEBREW ===\033[0m"
      brew update > /dev/null 2>&1
      OUTDATED_BREW=$(brew outdated)
      if [ -n "$OUTDATED_BREW" ]; then
        BREW_COUNT=$(echo "$OUTDATED_BREW" | wc -l | tr -d ' ')
        echo "๐ $BREW_COUNT outdated packages found"
        WARNINGS+=("$BREW_COUNT Homebrew packages need updating")
      else
        echo "โ All Homebrew packages up to date"
        SUMMARY_ITEMS+=("Homebrew packages are current")
      fi
      
      echo -e "\n\033[0;34m=== ๐ฆ CHECKING NPM GLOBAL ===\033[0m"
      OUTDATED_NPM=$(npm outdated -g 2>/dev/null)
      if [ -n "$OUTDATED_NPM" ]; then
        echo "๐ npm packages need updating"
        WARNINGS+=("Global npm packages need updating")
      else
        echo "โ All npm packages up to date"
        SUMMARY_ITEMS+=("npm global packages are current")
      fi
      
      echo -e "\n\033[0;34m=== ๐ด CHECKING RUBY GEMS ===\033[0m"
      OUTDATED_GEMS=$(gem outdated 2>/dev/null | wc -l | tr -d ' ')
      if [ "$OUTDATED_GEMS" -gt 0 ]; then
        echo "๐ $OUTDATED_GEMS gems need updating"
        WARNINGS+=("$OUTDATED_GEMS Ruby gems need updating")
      else
        echo "โ All gems up to date"
        SUMMARY_ITEMS+=("Ruby gems are current")
      fi
      
      # Interactive prompt for updates
      echo -e "\n\033[1;33mโก Would you like to proceed with updates and cleanup? (y/N):\033[0m"
      read -n 1 -r REPLY
      echo ""
      
      if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo -e "\n\033[0;32m๐ Starting maintenance cycle...\033[0m"
        
        echo -e "\n\033[0;34m=== ๐บ UPDATING HOMEBREW ===\033[0m"
        if brew upgrade; then
          ACTIONS_TAKEN+=("Updated Homebrew packages")
        fi
        
        echo -e "\n\033[0;34m=== ๐ฆ UPDATING NPM ===\033[0m"
        if npm update -g; then
          ACTIONS_TAKEN+=("Updated npm global packages")
        fi
        
        echo -e "\n\033[0;34m=== ๐ด UPDATING RUBY GEMS ===\033[0m"
        if gem update --system 2>/dev/null; then
          ACTIONS_TAKEN+=("Updated RubyGems system")
        else
          WARNINGS+=("RubyGems system update failed")
        fi
        if gem update; then
          ACTIONS_TAKEN+=("Updated Ruby gems")
        fi
        
        echo -e "\n\033[0;34m=== ๐งน SYSTEM CLEANUP ===\033[0m"
        brew cleanup && brew autoremove
        ACTIONS_TAKEN+=("Cleaned Homebrew cache and removed unused packages")
        
        npm cache verify
        ACTIONS_TAKEN+=("Verified and cleaned npm cache")
        
        gem cleanup
        ACTIONS_TAKEN+=("Cleaned up old Ruby gem versions")
        
        if command -v trash &> /dev/null; then
          trash -e
          ACTIONS_TAKEN+=("Emptied system trash")
        else
          WARNINGS+=("Trash utility not available - install with: brew install trash")
        fi
        
        ACTIONS_TAKEN+=("User approved and completed full maintenance cycle")
      else
        SUMMARY_ITEMS+=("User skipped updates and cleanup")
        echo "\033[0;33mโญ๏ธ  Skipped updates and cleanup\033[0m"
      fi
      
      # Generate report
      REPORT_FILE="$HOME/system_report_$(date +%Y%m%d_%H%M%S).txt"
      echo "=== ๐ SYSTEM MAINTENANCE REPORT ===" > "$REPORT_FILE"
      echo "Generated: $(date)" >> "$REPORT_FILE"
      echo "" >> "$REPORT_FILE"
      
      echo "๐ฅ๏ธ  SYSTEM INFO:" >> "$REPORT_FILE"
      sw_vers >> "$REPORT_FILE"
      echo "" >> "$REPORT_FILE"
      
      echo "๐พ DISK SPACE:" >> "$REPORT_FILE"
      df -h / >> "$REPORT_FILE"
      echo "" >> "$REPORT_FILE"
      
      echo "๐ฆ INSTALLED VERSIONS:" >> "$REPORT_FILE"
      echo "Homebrew: $(brew --version | head -1)" >> "$REPORT_FILE"
      echo "Node.js: $(node --version 2>/dev/null || echo 'Not installed')" >> "$REPORT_FILE"
      echo "npm: $(npm --version 2>/dev/null || echo 'Not installed')" >> "$REPORT_FILE"
      echo "Python: $(python3 --version 2>/dev/null || echo 'Not installed')" >> "$REPORT_FILE"
      echo "Ruby: $(ruby -v 2>/dev/null || echo 'Not installed')" >> "$REPORT_FILE"
      echo "Java: $(java -version 2>&1 | head -1 2>/dev/null || echo 'Not installed')" >> "$REPORT_FILE"
      
      ACTIONS_TAKEN+=("Generated detailed system report")
      
      # Comprehensive Summary
      echo -e "\n\033[0;35mโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ\033[0m"
      echo -e "\033[0;35mโ                           ๐ MAINTENANCE SUMMARY                               โ\033[0m"
      echo -e "\033[0;35mโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ\033[0m"
      
      echo -e "\n\033[0;36m๐ Completed:\033[0m $(date)"
      echo -e "\033[0;36mโก Command:\033[0m Complete System Maintenance"
      
      if [[ ${#SUMMARY_ITEMS[@]} -gt 0 ]]; then
        echo -e "\n\033[0;32mโ Status Checks:\033[0m"
        for item in "${SUMMARY_ITEMS[@]}"; do
          echo -e "   โข $item"
        done
      fi
      
      if [[ ${#ACTIONS_TAKEN[@]} -gt 0 ]]; then
        echo -e "\n\033[0;34m๐ง Actions Completed:\033[0m"
        for action in "${ACTIONS_TAKEN[@]}"; do
          echo -e "   โข $action"
        done
      fi
      
      if [[ ${#WARNINGS[@]} -gt 0 ]]; then
        echo -e "\n\033[0;33mโ๏ธ  Warnings:\033[0m"
        for warning in "${WARNINGS[@]}"; do
          echo -e "   โข $warning"
        done
      fi
      
      if [[ ${#ERRORS[@]} -gt 0 ]]; then
        echo -e "\n\033[0;31mโ Issues Found:\033[0m"
        for error in "${ERRORS[@]}"; do
          echo -e "   โข $error"
        done
      fi
      
      FREE_SPACE=$(diskutil info / | grep -E "Free Space" | awk '{print $4 " " $5}' | sed 's/[(),]//g')
      echo -e "\n\033[0;36m๐พ System Status:\033[0m"
      echo -e "   โข Free disk space: $FREE_SPACE"
      echo -e "   โข macOS: $MACOS_VERSION"
      echo -e "   โข Downloads folder: $DOWNLOADS_SIZE"
      echo -e "   โข Desktop folder: $DESKTOP_SIZE"
      echo -e "   โข Cache folder: $CACHE_SIZE"
      
      echo -e "\n\033[0;35m๐ฏ Recommendations:\033[0m"
      echo -e "   โข System maintenance cycle completed"
      echo -e "   โข Schedule next maintenance in 1-2 weeks"
      echo -e "   โข Review detailed report: $REPORT_FILE"
      
      if [[ "$DOWNLOADS_SIZE" == *"G" ]] && [[ $(echo "$DOWNLOADS_SIZE" | sed 's/G.*//') -gt 10 ]]; then
        echo -e "   โข \033[0;33mConsider cleaning Downloads folder ($DOWNLOADS_SIZE)\033[0m"
      fi
      
      if [[ "$CACHE_SIZE" == *"G" ]] && [[ $(echo "$CACHE_SIZE" | sed 's/G.*//') -gt 15 ]]; then
        echo -e "   โข \033[0;33mCache folder is large ($CACHE_SIZE) - normal but monitor\033[0m"
      fi
      
      echo -e "\n\033[0;35mโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ\033[0m"
      
      echo -e "\n\033[0;32m๐ Report saved to: $REPORT_FILE\033[0m"
